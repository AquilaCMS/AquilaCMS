<!doctype html>
<html>
<header>
    <meta charset="UTF-8">
    <title>Aquila - Installer</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/material-design-lite/1.3.0/material.min.js"
        integrity="sha512-mPYFRGkgrXvIQo9eMKjv5vuy73j7kXXelllj3W49nVCKarBVOUxNai2dnqVIp8QnnVS7AKHwdFyZSVibSqWtkw=="
        crossorigin="anonymous"
    ></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous"
    ></script>

    <style>
        .demo-card-square.mdl-card {
            width: 30%;
            min-width: 350px;

            margin: auto;
            margin-top: 30px;
        }

        .demo-card-square>.mdl-card__title {
            color: #fff;
            background: url('data:image/png;base64,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') bottom 40% right 15% no-repeat #46B6AC;
            background-size: 130px;
            height: 200px;
        }

        .mdl-card__supporting-text>div {
            width: 100%
        }

        .labelforselect {
            color: rgb(63, 81, 181);
            font-size: 12px
        }

        .mdl-list__item--three-line {
            height: 135px;
        }

        .aquilaCMSVersion {
            width: 30%;
            min-width: 350px;
            margin: auto;
            margin-top: 30px;
            color: slategray;
            text-align: right;
        }
    </style>

    <script>
        function NextStep() {
            document.getElementById("firstStep").style.display  = 'none';
            document.getElementById("secondStep").style.display = 'block';
            isRefreshable = false;
        }

        function RecoverConfiguration() {
            document.getElementById("firstStep").style.display   = 'none';
            document.getElementById("recoverStep").style.display = 'block';
            isRefreshable = false;
        }

        function Configuration() {
            let envPath = document.getElementById("envPath").value;

            if (envPath.substr(envPath.length - 5, envPath.length) !== '.json') {
                document.getElementById("envPathError").style.display = 'inline';
                return;
            }
            else {
                document.getElementById("envPathError").style.display = 'none';
            }

            // Control space char
            document.getElementById("databaseAdd").value = document.getElementById("databaseAdd").value.replace(/\s/g, "");
            document.getElementById("adminPrefix").value = document.getElementById("adminPrefix").value.replace(/\s/g, "");

            // Check fields
            let fieldError = "";

            fieldError = checkError("databaseAdd", fieldError);
            fieldError = checkError("envPath", fieldError);
            fieldError = checkError("appUrl", fieldError);
            fieldError = checkError("adminPrefix", fieldError);
            fieldError = checkError("firstname", fieldError);
            fieldError = checkError("lastname", fieldError);
            fieldError = checkError("email", fieldError);
            fieldError = checkError("password", fieldError);

            if(fieldError !== "") {
                console.error("A field is required");
                displayErrors("Please take a look on the following fields :<br/>" + fieldError);
                return;
            }
            else {
                document.getElementById("errorArea").style.display = "none";
            }

            let form             = $("#secondStep");
            let loader           = document.getElementById("loading");
            let config           = document.getElementById("config");
            loader.style.display = 'block';
            config.style.display = 'none';
            $.ajax({
                url: '/config',
                type: 'POST',
                data: form.serialize(),
                success: (response, status) => {
                    isRefreshable = true;
                    document.getElementById("loadingPanel").style.color = "red";

                    if(response === "ManualRestart") {
                        document.getElementById("loadingPanel").innerHTML   = "Congratulations, install is done !<br/>Please restart your server and refresh this page.";
                    }
                    else {
                        document.getElementById("loadingPanel").innerHTML   = "Congratulations, install is done !<br/>Please wait while your server restarts.";
                        setTimeout(() => {
                            window.location.href = `${window.location.origin}/`;
                        }, 30000);
                    }
                },
                error: (response, status, error) => {
                    console.error(response, status, error);

                    displayErrors(response.responseText);
                }
            });
        }

        function checkError(fieldId, fieldError){

            const fieldValue = document.getElementById(fieldId).value;

            // Custom fields
            if(fieldId === "databaseAdd" && (fieldValue === "mongodb://127.0.0.1:27017/")) {
                return fieldError + "- MongoDB needs database name<br/>";
            }
            if(fieldId === "appUrl" && fieldValue === "http://") {
                return fieldError + "- Website url needs a real url<br/>";
            }
            if(fieldId === "password") {
                const passwordValidator = new RegExp("^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9]).{6,}$");
                if(!passwordValidator.test(fieldValue)){
                    return fieldError + "- Password is incorrect (6 characters, 1 uppercase letter, 1 lowercase letter, 1 number)<br/>";
                }
            }
            if(fieldValue === "") {
                fieldError = fieldError + "- " + fieldId + " is empty<br/>";
            }
            return fieldError;
        }

        function displayErrors(sError) {
            document.getElementById("errorArea").innerHTML     = sError;
            document.getElementById("errorArea").style.display = "block";

            document.getElementById("loading").style.display = 'none';
            document.getElementById("config").style.display = 'block';

            // let toastContain = document.getElementById("toast-container");
            // toastContain.style.backgroundColor = "red";
            // toastContain.MaterialSnackbar.showSnackbar({message: "Some errors are detected"});
        }

        function Recover() {
            let form             = $("#secondStep");
            let loader           = document.getElementById("loading");
            let config           = document.getElementById("config");
            let errorDiv         = document.getElementById("errorRecoverDiv");
            let errorMsg         = document.getElementById("errorRecover");
            loader.style.display = 'block';
            config.style.display = 'none';
            $.ajax({
                url: '/recover',
                type: 'POST',
                data: form.serialize(),
                success: (response, status) => {
                    errorDiv.style.display = "none";
                    window.location.href = `${window.location.origin}/`;
                },
                error: (response, status, error) => {
                    errorDiv.style.display = "block";
                    errorMsg.innerHTML = response.responseText;
                    loader.style.display = 'none';
                    config.style.display = 'block';
                    console.error(response, status, error);
                }
            });
        }

        function testDB(){

            let testDBLoader = document.getElementById("testDBLoader");
            let testDBButton = document.getElementsByClassName("testDB")[0];
            let toastContain = document.getElementById("toast-container");

            const fieldValue = document.getElementById("databaseAdd").value.replace(/\s/g, "");

            const partValue = fieldValue.split("://");
            if(typeof partValue[1]  !== "undefined"){
                const secondPart = partValue[1].split("/");
                if((typeof secondPart[1] !== "undefined" && secondPart[1] === "") || typeof secondPart[1] === "undefined") {
                    toastContain.style.backgroundColor = "darkorange";
                    toastContain.MaterialSnackbar.showSnackbar({message: "The connection string needs to have the name of the database, example : 'mongodb://127.0.0.1:27017/database'"});
                    return;
                }
            }

            testDBLoader.style.display = 'block';
            testDBButton.style.display = 'none';


            $.ajax({
                url: '/testdb',
                type: 'POST',
                data: {data:document.getElementById("databaseAdd").value},
                success: (response, status) => {
                    testDBLoader.style.display         = 'none';
                    testDBButton.style.display         = 'block';
                    toastContain.style.backgroundColor = "green";
                    toastContain.MaterialSnackbar.showSnackbar({message: 'Successful connection'});
                },
                error: (response, status, error) => {
                    testDBLoader.style.display         = 'none';
                    testDBButton.style.display         = 'block';
                    toastContain.style.backgroundColor = "red";
                    if(response.responseText){
                        toastContain.MaterialSnackbar.showSnackbar({message: response.responseText});
                    } else {
                        toastContain.MaterialSnackbar.showSnackbar({message: "An error has occurred"});
                    }
                    console.error(response, status, error);
                }
            });
        };

        let isRefreshable = true;
        window.addEventListener('beforeunload', function (e) {
            if(!isRefreshable) {
                e.preventDefault();
                e.returnValue = '';
            }
        });

    </script>
</header>

<body>
    <div class="demo-card-square mdl-card mdl-shadow--2dp" style="display: none;" id="loading">
        <div class="mdl-card__title mdl-card--expand">
            <h2 class="mdl-card__title-text">Configuration</h2>
        </div>
        <div class="mdl-card__supporting-text" id="loadingPanel">
            <p>
                Configuration and saving informations...
            </p>
            <p>
                <div id="p2" class="mdl-progress mdl-js-progress mdl-progress__indeterminate"></div>
            </p>
        </div>
    </div>

    <div id="config">
        <div class="demo-card-square mdl-card mdl-shadow--2dp" id="firstStep">
            <div class="mdl-card__title mdl-card--expand">
                <h2 class="mdl-card__title-text">1/ First launch</h2>
            </div>
            <div class="mdl-card__supporting-text">
                <p>
                    This is the first time that AquilaCMS is launched.
                </p>
                <p>
                    We will configure your application together in one step.
                </p>
                <p>
                    Your site will be up and running immediately after a reboot.
                    <br />
                    Please click on next and fill the requested information
                </p>

                <h6>Prerequisite :</h6>
                <ul class="mdl-list">
                    <li class="mdl-list__item mdl-list__item--three-line" id="wkhtmltopdf">
                        <span class="mdl-list__item-primary-content">
                            <span>wkhtmltopdf</span>
                            <span class="mdl-list__item-text-body" id="wkhtmlbody"></span>
                        </span>
                        <span class="mdl-list__item-secondary-content" id="wkhtmlvalid"></span>
                    </li>
                    <li class="mdl-list__item mdl-list__item--three-line" id="sharp">
                        <span class="mdl-list__item-primary-content">
                            <span>sharp</span>
                            <span class="mdl-list__item-text-body" id="sharpbody"></span>
                        </span>
                        <span class="mdl-list__item-secondary-content" id="sharpvalid"></span>
                    </li>
                </ul>
            </div>
            <div class="mdl-card__actions mdl-card--border">
                <div class="mdl-layout__header-row">
                    <div class="mdl-layout-spacer"></div>
                    <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" id="nextStep">
                        Next
                    </button>
                </div>
                <a style="font-size: 10px; color: rgb(63,81,181); cursor: pointer;" id="recoverConfiguration">
                    Recover existing configuration
                </a>
            </div>
        </div>

        <form name="configurationForm" class="demo-card-square mdl-card mdl-shadow--2dp" style="display: none" id="secondStep">
            <div class="mdl-card__title mdl-card--expand">
                <h2 class="mdl-card__title-text">2/ Configuration</h2>
            </div>
            <div class="mdl-card__supporting-text">

                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="text" id="siteName" name="siteName" required minlength="1">
                    <label class="mdl-textfield__label" for="siteName">Site Name</label>
                </div>

                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="text" id="envPath" name="envPath" required
                        value="config/env.json">
                    <label class="mdl-textfield__label" for="envPath">Path for the configuration <span style="color:#AAA">(must be a .json file)</span>
                        <span id="envPathError" style="color: red; display: none;">Not a .json file</span></label>
                </div>

                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="text" id="databaseAdd" name="databaseAdd" required
                        value="mongodb://127.0.0.1:27017/">
                    <label class="mdl-textfield__label" for="databaseAdd">Connection string to MongoDB <span style="color:#AAA">(if necessary, DB will be created)</span></label>
                </div>
                <button type="button" id="testDB" class="testDB mdl-button mdl-js-button mdl-button--primary" style="float: right;margin-top: -15px;">
                    Test connection
                </button>
                <div id="testDBLoader" style="display: none;">
                    <div style="float: right;margin-top: -15px;">
                        <div class="mdl-spinner mdl-js-spinner is-active"></div>
                    </div>
                </div>

                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="text" id="appUrl" name="appUrl" required value="http://">
                    <label class="mdl-textfield__label" for="appUrl">Website URL</label>
                </div>

                <!-- <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                        <input class="mdl-textfield__input" type="text" id="port" name="port" required>
                        <label class="mdl-textfield__label" for="port">Theme port</label>
                    </div> -->

                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="text" id="adminPrefix" name="adminPrefix" value="{{adminPrefix}}" required>
                    <label class="mdl-textfield__label" for="adminPrefix">Administration prefix <span style="color:#AAA">(for the backoffice access)</span></label>
                </div>

                <!-- <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                        <input class="mdl-textfield__input" type="text" id="currentTheme" name="currentTheme" required>
                        <label class="mdl-textfield__label" for="currentTheme">Path to the theme</label>
                    </div> -->

                <div>
                    <div class="labelforselect">
                        Default language <span style="color:#AAA">(for the store-front)</span></label>
                    </div>
                    <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="language-en">
                        <input type="radio" id="language-en" class="mdl-radio__button" name="language" value="en" checked>
                        <span class="mdl-radio__label">English</span>
                    </label>
                    <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="language-fr" style="margin-left:50px">
                        <input type="radio" id="language-fr" class="mdl-radio__button" name="language" value="fr">
                        <span class="mdl-radio__label">Fran√ßais</span>
                    </label>
                </div>

                <hr />

                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="text" id="firstname" name="firstname" required>
                    <label class="mdl-textfield__label" for="firstname">Administrator's firstname</label>
                </div>

                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="text" id="lastname" name="lastname" required>
                    <label class="mdl-textfield__label" for="lastname">Administrator's lastname</label>
                </div>

                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="email" id="email" name="email" required>
                    <label class="mdl-textfield__label" for="email">Administrator's email</label>
                </div>

                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="password" id="password" name="password" required>
                    <label class="mdl-textfield__label" for="password">Administrator's password</label>
                </div>


                <br /><br />

                <div id="tt1" style="width:140px">
                    <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="demoData">
                        <input type="checkbox" id="demoData" name="demoData" class="mdl-checkbox__input" checked="checked">
                        <span class="mdl-checkbox__label">Default datas</span>
                    </label>
                </div>
                <div class="mdl-tooltip" data-mdl-for="tt1">
                    Create fake datas for testing
                </div>

                <div id="tt2" style="width:140px">
                    <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="override">
                        <input type="checkbox" id="override" name="override" class="mdl-checkbox__input" checked="checked">
                        <span class="mdl-checkbox__label">Override</span>
                    </label>
                </div>
                <div class="mdl-tooltip" data-mdl-for="tt2">
                    Override informations in database if exist
                </div>

                <div id="tt3" style="width:140px">
                    <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="cron">
                        <input type="checkbox" id="cron" name="cron" class="mdl-checkbox__input" disabled="disabled">
                        <span class="mdl-checkbox__label">Autostart cron</span>
                    </label>
                </div>
                <div class="mdl-tooltip" data-mdl-for="tt3">
                    All cron are enable
                </div>

            </div>
            <div class="mdl-card__actions mdl-card--border" id="stepConfig">
                <div class="mdl-layout__header-row">
                    <div class="mdl-layout-spacer"></div>
                    <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" type="submit">
                        Save configuration
                    </button>
                </div>
            </div>

            <div style="color:red;display: none;text-align: center;" id="errorArea">
            </div>


            <div id="toast-container" class="mdl-js-snackbar mdl-snackbar">
                <div class="mdl-snackbar__text"></div>
                <button class="mdl-snackbar__action" type="button"></button>
            </div>

        </form>

        <form name="recoverForm" class="demo-card-square mdl-card mdl-shadow--2dp" style="display: none" id="recoverStep">
            <div class="mdl-card__title mdl-card--expand">
                <h2 class="mdl-card__title-text">2/ Recover existing configuration</h2>
            </div>
            <div class="mdl-card__supporting-text">
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="text" id="envPath" name="envPath" required>
                    <label class="mdl-textfield__label" for="envPath">Path for the existing configuration</label>
                </div>
            </div>
            <div class="mdl-card__supporting-text" style="display:none; margin:0px" id="errorRecoverDiv">
                <p id="errorRecover" style="color:red"></p>
            </div>
            <div class="mdl-card__actions mdl-card--border" id="stepConfig">
                <div class="mdl-layout__header-row" style="padding: 0px 40px 0 40px;">
                    <a class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" href="javascript:document.location.reload(true);">
                        Back
                    </a>
                    <div class="mdl-layout-spacer"></div>
                    <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" type="submit">
                        Save & restart
                    </button>
                </div>
            </div>
        </form>
    </div>
    <div class="aquilaCMSVersion">
        aquilaCMS: v{{aquilaCMSVersion}}
    </div>


    <script>
        document.getElementById("secondStep").addEventListener("submit", function(event){
            event.preventDefault();
            Configuration();
        });

        document.getElementById("recoverStep").addEventListener("submit", function(event){
            event.preventDefault();
            Recover();
        });

        document.getElementById("nextStep").addEventListener("click", function(event) {
            event.preventDefault();
            NextStep();
        })

        document.getElementById("recoverConfiguration").addEventListener("click", function(event) {
            event.preventDefault();
            RecoverConfiguration();
        })

        document.getElementById("testDB").addEventListener("click", function(event) {
            event.preventDefault();
            testDB();
        })

        const wkhtmltopdfIsValid = JSON.parse('{{wkhtmltopdf}}');
        let valid = `<span style="color: green;"><i class="material-icons">check_circle</i></span>`;
        let body  = '';
        const wkhtmltopdf = document.getElementById('wkhtmltopdf');

        if (wkhtmltopdfIsValid === false) {
            valid = `<span style="color: red;"><i class="material-icons">cancel</i></span>`;
            body = `The library seems missing on your system.<br>
            <a href="http://wkhtmltopdf.org/downloads.html#stable"><b>download</b></a>
            a prebuilt version for your system.<br>
            <b>DO NOT</b> try to use the packages provided by your distribution
            as they may not be using a patched Qt and have missing features.`;
        } else if (wkhtmltopdfIsValid === true) {
            wkhtmltopdf.classList.remove('mdl-list__item--three-line');
        }

        const wkhtmltopdfbody      = document.getElementById('wkhtmlbody');
        const wkhtmltopdfvalid     = document.getElementById('wkhtmlvalid');
        wkhtmltopdfbody.innerHTML  = body;
        wkhtmltopdfvalid.innerHTML = valid;

        const sharpIsValid = JSON.parse('{{sharp}}');
        valid = `<span style="color: green;"><i class="material-icons">check_circle</i></span>`;
        body  = '';
        const sharp = document.getElementById('sharp');

        if (sharpIsValid === false) {
            valid = `<span style="color: red;"><i class="material-icons">cancel</i></span>`;
            body = `to use sharp you needs to install <a href="https://github.com/libvips/libvips">libvips</a><br>
            or else problems might occur during aquila's usage`;
        } else if (sharpIsValid === true) {
            sharp.classList.remove('mdl-list__item--three-line');
        }

        const sharpbody      = document.getElementById('sharpbody');
        const sharpvalid     = document.getElementById('sharpvalid');
        sharpbody.innerHTML  = body;
        sharpvalid.innerHTML = valid;

        document.getElementById("appUrl").value = `${window.location.origin}/`;
    </script>
</body>
</html>